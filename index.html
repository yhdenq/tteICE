<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Treatment Effect Estimation for Time-to-Event Data with Intercurrent Events • tteICE</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Treatment Effect Estimation for Time-to-Event Data with Intercurrent Events">
<meta name="description" content="Analysis of treatment effects in clinical trials with time-to-event outcomes is complicated by intercurrent events. This package implements methods for estimating and inferring the cumulative incidence functions for time-to-event (TTE) outcomes with intercurrent events (ICE) under the five strategies outlined in the ICH E9 (R1) addendum, see Deng (2025) &lt;doi:10.1002/sim.70091&gt;. This package can be used for analyzing data from both randomized controlled trials and observational studies. In general, the data involve a primary outcome event and, potentially, an intercurrent event. Two data structures are allowed: competing risks, where only the time to the first event is recorded, and semicompeting risks, where the times to both the primary outcome event and intercurrent event (or censoring) are recorded. For estimation methods, users can choose nonparametric estimation (which does not use covariates) and semiparametrically efficient estimation.">
<meta property="og:description" content="Analysis of treatment effects in clinical trials with time-to-event outcomes is complicated by intercurrent events. This package implements methods for estimating and inferring the cumulative incidence functions for time-to-event (TTE) outcomes with intercurrent events (ICE) under the five strategies outlined in the ICH E9 (R1) addendum, see Deng (2025) &lt;doi:10.1002/sim.70091&gt;. This package can be used for analyzing data from both randomized controlled trials and observational studies. In general, the data involve a primary outcome event and, potentially, an intercurrent event. Two data structures are allowed: competing risks, where only the time to the first event is recorded, and semicompeting risks, where the times to both the primary outcome event and intercurrent event (or censoring) are recorded. For estimation methods, users can choose nonparametric estimation (which does not use covariates) and semiparametrically efficient estimation.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">tteICE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mephas/tteICE/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><ul>
<li><a href="#randomized-trials-and-observational-studies">Randomized trials and observational studies</a></li>
<li><a href="#five-strategies-to-deal-with-intercurrent-events">Five strategies to deal with intercurrent events</a></li>
<li><a href="#two-types-of-data-structures">Two types of data structures</a></li>
<li>
<a href="#about-this-package">About this package</a>
<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#example">Example</a></li>
<li><a href="#competing-risks-data-structure">Competing risks data structure</a></li>
<li><a href="#semicompeting-risks-data-structure">Semicompeting risks data structure</a></li>
<li>
<a href="#using-formula-to-fit-the-model">Using formula to fit the model</a>
<ul>
<li><a href="#competing-risks-data-structure-1">Competing risks data structure</a></li>
<li><a href="#semicompeting-risks-data-structure-1">Semicompeting risks data structure</a></li>
</ul>
</li>
<li><a href="#remarks-on-methodology">Remarks on methodology</a></li>
</ul>
</li>
</ul>
<!-- README.md is generated from README.Rmd. Please edit that file --><!-- badges: start --><!-- [![R-CMD-check](https://github.com/mephas/tteICE/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/mephas/tteICE/actions/workflows/R-CMD-check.yaml) -->
<!-- badges: end -->
<p>The goal of the package “tteICE” is to estimate the treatment effect for time-to-event outcomes with intercurrent events.</p>
<div class="section level2">
<h2 id="randomized-trials-and-observational-studies">Randomized trials and observational studies<a class="anchor" aria-label="anchor" href="#randomized-trials-and-observational-studies"></a>
</h2>
<p><strong>Randomized trials</strong> are the best form of experiments for evaluating the treatment effect because confounders are naturally balanced between treatment groups. The difference in outcomes between treatment groups is explained by the treatment condition. In observational studies, confounders (observed or unobserved) are not balanced. To estimate the treatment effect, we need to assume all confounders are collected. Then we may use matching, weighting, or emulating trial methods to create a sample analogue to randomized trials. Although methods for randomized trials apply to observational studies after adjusting for confounders, one should be careful in making causal conclusions based on observational studies due to the threat of unmeasured confounding.</p>
</div>
<div class="section level2">
<h2 id="five-strategies-to-deal-with-intercurrent-events">Five strategies to deal with intercurrent events<a class="anchor" aria-label="anchor" href="#five-strategies-to-deal-with-intercurrent-events"></a>
</h2>
<p><strong>The ICH E9 (R1)</strong> proposed five strategies to deal with intercurrent events: treatment policy strategy, composite variable strategy, hypothetical strategy, while on treatment strategy, and principal stratum strategy. To answer a specific scientific question, a corresponding strategy should be chosen before the experimental design and data analysis. The estimand to describe the distribution of the time to the primary outcome event is the potential cumulative incidence function (CIF). The treatment effect is defined as the contrast of the potential cumulative incidence functions under treated and control.</p>
<ul>
<li>
<strong>Treatment policy strategy.</strong> The treatment policy strategy addresses the problem of intercurrent events by expanding the initial treatment conditions to a treatment policy. This strategy is applicable only if intercurrent events do not hinder primary outcome events. It is confined to a semicompeting risks context.</li>
<li>
<strong>Composite variable strategy.</strong> The composite variable strategy addresses the problem of intercurrent events by expanding the outcome variables. It aggregates the intercurrent event and primary outcome event into a single composite outcome variable.</li>
<li>
<strong>Hypothetical strategy.</strong> The hypothetical strategy envisions a hypothetical clinical trial condition where the occurrence of intercurrent events is restricted in certain ways. By doing so, the distribution of potential outcomes under the hypothetical scenario can capture the impact of intercurrent events explicitly through a pre-specified criterion. The hypothetical strategy is closely related to mediation analysis, which is intended to evaluate the direct and indirect effects using semicompeting risks data.</li>
<li>
<strong>While on treatment strategy.</strong> The while on treatment strategy considers the measure of outcome variables taken only up to the occurrence of intercurrent events. The failures of primary outcome events should not be counted in the cumulative incidences if intercurrent events occurred. The while on treatment strategy is closely related to the competing risks model.</li>
<li>
<strong>Principal stratum strategy.</strong> The principal stratum strategy aims to stratify the population into subpopulations based on the joint potential occurrences of intercurrent events under the two treatment assignments. Usually, we are interested in a principal stratum comprised of individuals who would never experience intercurrent events, regardless of which treatment they receive. A principal ignorability assumption is made.</li>
</ul>
</div>
<div class="section level2">
<h2 id="two-types-of-data-structures">Two types of data structures<a class="anchor" aria-label="anchor" href="#two-types-of-data-structures"></a>
</h2>
<p>In particular, we consider two types of data structures.</p>
<ul>
<li>
<strong>Competing risks.</strong> Only the time to the first occurrence of either the primary outcome event or the intercurrent event is recorded. An indicator describes the type of this event, i.e., whether it is the primary outcome event, intercurrent event, or censoring. The treatment policy strategy cannot be applied to competing risks data.</li>
<li>
<strong>Semicompeting risks.</strong> Both the time to the primary outcome event and the time to the intercurrent event are recorded. The censoring indicators for these events are also recorded. All five strategies can be applied to semicompeting risks data.</li>
</ul>
<p>The composite variable strategy, while on treatment strategy, principal stratum strategy, and hypothetical strategy (II, removed) yield the same results for the competing risks and semicompeting risks data, since only the first occurrence of events is used. The hypothetical strategy (I, natural) yields different results for the competing risks and semicompeting risks data, since both cause-specific hazards of the primary event contribute to the counterfactual cumulative incidence function for semicompeting risk data.</p>
<hr>
<p>References:</p>
<p>[1] International Conference on Harmonization (2019). ICH E9 (R1): Addendum to Statistical Principles for Clinical Trials on Choosing Appropriate Estimands and Defining Sensitivity Analyses in Clinical Trials. (Step 4 version dated 20 November 2019). <a href="https://database.ich.org/sites/default/files/E9-R1_Step4_Guideline_2019_1203.pdf" class="external-link uri">https://database.ich.org/sites/default/files/E9-R1_Step4_Guideline_2019_1203.pdf</a>.</p>
<p>[2] Deng, Y., Han, S., &amp; Zhou, X. H. (2025). Inference for Cumulative Incidences and Treatment Effects in Randomized Controlled Trials With Time‐to‐Event Outcomes Under ICH E9 (R1). Statistics in Medicine. <a href="https://doi.org/10.1002/sim.70091" class="external-link uri">https://doi.org/10.1002/sim.70091</a>.</p>
<hr>
</div>
<div class="section level1">
<div class="page-header"><h1 id="about-this-package">About this package<a class="anchor" aria-label="anchor" href="#about-this-package"></a>
</h1></div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of “tteICE” from GitHub with:</p>
<p><strong>(We are updaing the package)</strong></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"mephas/tteICE"</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, you can install “tteICE” from R CRAN with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"tteICE"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>We use the <code>bmt</code> data to illustrate how to estimate the treatment effect. The primary event is death, and the intercurrent event is relapse.</p>
</div>
<div class="section level2">
<h2 id="competing-risks-data-structure">Competing risks data structure<a class="anchor" aria-label="anchor" href="#competing-risks-data-structure"></a>
</h2>
<p>The time to the first event (either death or relapse) is t2. The event indicator is d4=d2+d3, so that d4=1 if death occurs first, while d4=2 if relapse occurs first.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mephas/tteICE" class="external-link">tteICE</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">bmt</span><span class="op">)</span></span>
<span><span class="va">A</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">bmt</span><span class="op">$</span><span class="va">group</span><span class="op">&gt;</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">bmt</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'z1'</span>,<span class="st">'z3'</span>,<span class="st">'z5'</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">bmt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">bmt</span>, d4<span class="op">=</span><span class="va">d2</span><span class="op">+</span><span class="va">d3</span><span class="op">)</span></span>
<span><span class="va">bmt</span><span class="op">$</span><span class="va">A</span> <span class="op">=</span> <span class="va">A</span></span></code></pre></div>
<p>Suppose we would like to use the hypothetical strategy (natural effects). We fit the model by nonparametric estimation.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit1</span> <span class="op">=</span> <span class="fu"><a href="https://mephas.github.io/tteICE/reference/surv.tteICE.html">surv.tteICE</a></span><span class="op">(</span><span class="va">A</span>, <span class="va">bmt</span><span class="op">$</span><span class="va">t2</span>, <span class="va">bmt</span><span class="op">$</span><span class="va">d4</span>, <span class="st">"natural"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/plot_inc.html">plot_inc</a></span><span class="op">(</span><span class="va">fit1</span>, plot.configs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'AML'</span>,<span class="st">'ALL'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-example_1-1.png" alt="" width="70%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="reference/plot_ate.html">plot_ate</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-example_1-2.png" alt="" width="70%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## We can also use bootstrap confidence intervals</span></span>
<span><span class="co"># plot_ate(fit1, nboot=200)</span></span></code></pre></div>
<p>We can also use inverse probability weighting to account for confounding.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit2</span> <span class="op">=</span> <span class="fu"><a href="https://mephas.github.io/tteICE/reference/surv.tteICE.html">surv.tteICE</a></span><span class="op">(</span><span class="va">A</span>, <span class="va">bmt</span><span class="op">$</span><span class="va">t2</span>, <span class="va">bmt</span><span class="op">$</span><span class="va">d4</span>, <span class="st">"natural"</span>, <span class="va">X</span>, method<span class="op">=</span><span class="st">'ipw'</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/plot_inc.html">plot_inc</a></span><span class="op">(</span><span class="va">fit2</span>, plot.configs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'AML'</span>,<span class="st">'ALL'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-example_2-1.png" alt="" width="70%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="reference/plot_ate.html">plot_ate</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-example_2-2.png" alt="" width="70%" style="display: block; margin: auto;"></p>
<p>To increase efficiency, we use the efficient influence function (EIF)-based method.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit3</span> <span class="op">=</span> <span class="fu"><a href="https://mephas.github.io/tteICE/reference/surv.tteICE.html">surv.tteICE</a></span><span class="op">(</span><span class="va">A</span>, <span class="va">bmt</span><span class="op">$</span><span class="va">t2</span>, <span class="va">bmt</span><span class="op">$</span><span class="va">d4</span>, <span class="st">"natural"</span>, <span class="va">X</span>, method<span class="op">=</span><span class="st">'eff'</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/plot_inc.html">plot_inc</a></span><span class="op">(</span><span class="va">fit3</span>, plot.configs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'AML'</span>,<span class="st">'ALL'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-example_3-1.png" alt="" width="70%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="reference/plot_ate.html">plot_ate</a></span><span class="op">(</span><span class="va">fit3</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-example_3-2.png" alt="" width="70%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="semicompeting-risks-data-structure">Semicompeting risks data structure<a class="anchor" aria-label="anchor" href="#semicompeting-risks-data-structure"></a>
</h2>
<p>Note that the time to death (or censoring) is t1 and the time to relapse (or censoring) is t2. We use the hypothetical strategy (natural effects) and fit the model nonparametrically.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit4</span> <span class="op">=</span> <span class="fu"><a href="https://mephas.github.io/tteICE/reference/scr.tteICE.html">scr.tteICE</a></span><span class="op">(</span><span class="va">A</span>, <span class="va">bmt</span><span class="op">$</span><span class="va">t1</span>, <span class="va">bmt</span><span class="op">$</span><span class="va">d1</span>, <span class="va">bmt</span><span class="op">$</span><span class="va">t2</span>, <span class="va">bmt</span><span class="op">$</span><span class="va">d2</span>, <span class="st">"natural"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/plot_inc.html">plot_inc</a></span><span class="op">(</span><span class="va">fit4</span>, plot.configs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'AML'</span>,<span class="st">'ALL'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-example_4-1.png" alt="" width="70%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="reference/plot_ate.html">plot_ate</a></span><span class="op">(</span><span class="va">fit4</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-example_4-2.png" alt="" width="70%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## We can also use bootstrap confidence intervals</span></span>
<span><span class="co"># plot_ate(fit4, nboot=200)</span></span></code></pre></div>
<p>We can also use inverse probability weighting to account for confounding.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit5</span> <span class="op">=</span> <span class="fu"><a href="https://mephas.github.io/tteICE/reference/scr.tteICE.html">scr.tteICE</a></span><span class="op">(</span><span class="va">A</span>, <span class="va">bmt</span><span class="op">$</span><span class="va">t1</span>, <span class="va">bmt</span><span class="op">$</span><span class="va">d1</span>, <span class="va">bmt</span><span class="op">$</span><span class="va">t2</span>, <span class="va">bmt</span><span class="op">$</span><span class="va">d2</span>, <span class="st">"natural"</span>, <span class="va">X</span>, method<span class="op">=</span><span class="st">'ipw'</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/plot_inc.html">plot_inc</a></span><span class="op">(</span><span class="va">fit5</span>, plot.configs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'AML'</span>,<span class="st">'ALL'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-example_5-1.png" alt="" width="70%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="reference/plot_ate.html">plot_ate</a></span><span class="op">(</span><span class="va">fit5</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-example_5-2.png" alt="" width="70%" style="display: block; margin: auto;"></p>
<p>To increase efficiency, we use the efficient influence function (EIF)-based method.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit6</span> <span class="op">=</span> <span class="fu"><a href="https://mephas.github.io/tteICE/reference/scr.tteICE.html">scr.tteICE</a></span><span class="op">(</span><span class="va">A</span>, <span class="va">bmt</span><span class="op">$</span><span class="va">t1</span>, <span class="va">bmt</span><span class="op">$</span><span class="va">d1</span>, <span class="va">bmt</span><span class="op">$</span><span class="va">t2</span>, <span class="va">bmt</span><span class="op">$</span><span class="va">d2</span>, <span class="st">"natural"</span>, <span class="va">X</span>, method<span class="op">=</span><span class="st">'eff'</span><span class="op">)</span> </span>
<span><span class="fu"><a href="reference/plot_inc.html">plot_inc</a></span><span class="op">(</span><span class="va">fit6</span>, plot.configs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'AML'</span>,<span class="st">'ALL'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-example_6-1.png" alt="" width="70%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="reference/plot_ate.html">plot_ate</a></span><span class="op">(</span><span class="va">fit6</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-example_6-2.png" alt="" width="70%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="using-formula-to-fit-the-model">Using formula to fit the model<a class="anchor" aria-label="anchor" href="#using-formula-to-fit-the-model"></a>
</h2>
<div class="section level3">
<h3 id="competing-risks-data-structure-1">Competing risks data structure<a class="anchor" aria-label="anchor" href="#competing-risks-data-structure-1"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span> <span class="co">## need this package</span></span>
<span><span class="va">fit7</span> <span class="op">=</span> <span class="fu"><a href="https://mephas.github.io/tteICE/reference/tteICE-package.html">tteICE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">t2</span>, <span class="va">d4</span>, type <span class="op">=</span> <span class="st">"mstate"</span><span class="op">)</span><span class="op">~</span><span class="va">A</span><span class="op">|</span><span class="va">z1</span><span class="op">+</span><span class="va">z3</span><span class="op">+</span><span class="va">z5</span>, data<span class="op">=</span><span class="va">bmt</span>, strategy<span class="op">=</span><span class="st">"natural"</span>, method<span class="op">=</span><span class="st">'eff'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit7</span>, type<span class="op">=</span><span class="st">"inc"</span>, plot.configs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'AML'</span>,<span class="st">'ALL'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-example_7-1.png" alt="" width="70%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit7</span><span class="op">)</span></span>
<span><span class="co">#&gt; Input:</span></span>
<span><span class="co">#&gt; tteICE(formula = Surv(t2, d4, type = "mstate") ~ A | z1 + z3 + </span></span>
<span><span class="co">#&gt;     z5, data = bmt, strategy = "natural", method = "eff")</span></span>
<span><span class="co">#&gt; -----------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; Data type: competing risks </span></span>
<span><span class="co">#&gt; Strategy: hypothetical strategy (controlling the hazard of ICEs) </span></span>
<span><span class="co">#&gt; Estimation method: semiparametrically efficient estimation </span></span>
<span><span class="co">#&gt; Observations: 137 (including 99 treated and 38 control)</span></span>
<span><span class="co">#&gt; Maximum follow-up time: 2640 </span></span>
<span><span class="co">#&gt; P-value of the average treatment effect: 0.4562 </span></span>
<span><span class="co">#&gt; -----------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; The estimated cumulative incidences and treatment effects at quartiles:</span></span>
<span><span class="co">#&gt;           660    1320    1980    2640</span></span>
<span><span class="co">#&gt; CIF1   0.2107  0.2386  0.2386  0.2855</span></span>
<span><span class="co">#&gt; se1    0.0432  0.0461  0.0461  0.0607</span></span>
<span><span class="co">#&gt; CIF0   0.3058  0.3058  0.3058  0.3058</span></span>
<span><span class="co">#&gt; se0    0.0703  0.0703  0.0703  0.0703</span></span>
<span><span class="co">#&gt; ATE   -0.0951 -0.0672 -0.0672 -0.0204</span></span>
<span><span class="co">#&gt; se     0.0784  0.0788  0.0788  0.0863</span></span>
<span><span class="co">#&gt; p.val  0.2250  0.3937  0.3937  0.8132</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit7</span><span class="op">)</span></span>
<span><span class="co">#&gt;               660        1320        1980        2640</span></span>
<span><span class="co">#&gt; CIF1   0.21074266  0.23860240  0.23860240  0.28547077</span></span>
<span><span class="co">#&gt; se1    0.04315013  0.04605499  0.04605499  0.06066512</span></span>
<span><span class="co">#&gt; CIF0   0.30584925  0.30584925  0.30584925  0.30584925</span></span>
<span><span class="co">#&gt; se0    0.07026486  0.07026486  0.07026486  0.07026486</span></span>
<span><span class="co">#&gt; ATE   -0.09510659 -0.06724685 -0.06724685 -0.02037848</span></span>
<span><span class="co">#&gt; se     0.07837881  0.07884710  0.07884710  0.08625633</span></span>
<span><span class="co">#&gt; p.val  0.22496844  0.39372770  0.39372770  0.81323485</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="semicompeting-risks-data-structure-1">Semicompeting risks data structure<a class="anchor" aria-label="anchor" href="#semicompeting-risks-data-structure-1"></a>
</h3>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">fit8</span> <span class="op">=</span> <span class="fu"><a href="https://mephas.github.io/tteICE/reference/tteICE-package.html">tteICE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">t1</span>, <span class="va">d1</span><span class="op">)</span><span class="op">~</span><span class="va">A</span><span class="op">|</span><span class="va">z1</span><span class="op">+</span><span class="va">z3</span><span class="op">+</span><span class="va">z5</span>, add.scr<span class="op">=</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">t2</span>,<span class="va">d2</span><span class="op">)</span>, data<span class="op">=</span><span class="va">bmt</span>, strategy<span class="op">=</span><span class="st">"natural"</span>, method<span class="op">=</span><span class="st">'eff'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit8</span>, type<span class="op">=</span><span class="st">"inc"</span>, plot.configs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'AML'</span>,<span class="st">'ALL'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-example_8-1.png" alt="" width="70%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit8</span><span class="op">)</span></span>
<span><span class="co">#&gt; Input:</span></span>
<span><span class="co">#&gt; tteICE(formula = Surv(t1, d1) ~ A | z1 + z3 + z5, add.scr = ~Surv(t2, </span></span>
<span><span class="co">#&gt;     d2), data = bmt, strategy = "natural", method = "eff")</span></span>
<span><span class="co">#&gt; -----------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; Data type: semicompeting risks </span></span>
<span><span class="co">#&gt; Strategy: hypothetical strategy (controlling the hazard of ICEs) </span></span>
<span><span class="co">#&gt; Estimation method: semiparametrically efficient estimation </span></span>
<span><span class="co">#&gt; Observations: 137 (including 99 treated and 38 control)</span></span>
<span><span class="co">#&gt; Maximum follow-up time: 2640 </span></span>
<span><span class="co">#&gt; P-value of the average treatment effect: 0.8945 </span></span>
<span><span class="co">#&gt; -----------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; The estimated cumulative incidences and treatment effects at quartiles:</span></span>
<span><span class="co">#&gt;           660    1320    1980   2640</span></span>
<span><span class="co">#&gt; CIF1   0.5344  0.6028  0.6028 0.6520</span></span>
<span><span class="co">#&gt; se1    0.0553  0.0569  0.0569 0.0603</span></span>
<span><span class="co">#&gt; CIF0   0.5597  0.6079  0.6079 0.6079</span></span>
<span><span class="co">#&gt; se0    0.0664  0.0622  0.0622 0.0622</span></span>
<span><span class="co">#&gt; ATE   -0.0254 -0.0052 -0.0052 0.0441</span></span>
<span><span class="co">#&gt; se     0.0685  0.0655  0.0655 0.0711</span></span>
<span><span class="co">#&gt; p.val  0.7112  0.9373  0.9373 0.5356</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit8</span><span class="op">)</span></span>
<span><span class="co">#&gt;               660        1320        1980       2640</span></span>
<span><span class="co">#&gt; CIF1   0.53436338  0.60278356  0.60278356 0.65201552</span></span>
<span><span class="co">#&gt; se1    0.05527063  0.05685682  0.05685682 0.06031028</span></span>
<span><span class="co">#&gt; CIF0   0.55974502  0.60794149  0.60794149 0.60794149</span></span>
<span><span class="co">#&gt; se0    0.06643936  0.06218743  0.06218743 0.06218743</span></span>
<span><span class="co">#&gt; ATE   -0.02538164 -0.00515793 -0.00515793 0.04407403</span></span>
<span><span class="co">#&gt; se     0.06854998  0.06552374  0.06552374 0.07113865</span></span>
<span><span class="co">#&gt; p.val  0.71118529  0.93725654  0.93725654 0.53555338</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="remarks-on-methodology">Remarks on methodology<a class="anchor" aria-label="anchor" href="#remarks-on-methodology"></a>
</h2>
<p>To identify the potential CIF and treatment effect, we make the following assumptions. When the semiparametrically efficient estimation method is used, these assumptions are made conditional on covariates.</p>
<ul>
<li>Stable unit treatment value assumption (SUTVA). All individuals are independent, and there is only one version of potential outcomes associated with each treatment condition.</li>
<li>Consistency. The potential time to events and event indicators associated with the realized treatment condition are observable.</li>
<li>Randomization. The treatment is independent of potential outcomes, i.e., the treatment assignment is randomized.</li>
<li>Random censoring. The potential censoring time is independent of potential event times.</li>
<li>Positivity. There is a positive probability for each individual to be treated or controlled. There is a positive probability that the censoring time is larger than the end of study.</li>
<li>Principal ignorability. The potential time to the primary outcome event does not rely on the cross-world potential time to the intercurrent event. This assumption is only required for the principal stratum strategy.</li>
</ul>
<p>The five strategies differ in the scientific questions to answer and, therefore, incorporate intercurrent events differently. The treatment policy strategy considers the effect on primary outcome events with intercurrent events as natural. Because the intercurrent event is considered part of the treatment condition, any difference in the hazards of intercurrent events between the treatment groups reflects the effect of the treatment policy. The composite variable strategy considers a composite of the primary outcome event and the intercurrent event. The while on treatment strategy estimand quantifies the total effect on the cumulative incidence of the primary outcome event, which is contributed by two sources: one is the effect of changing the hazard of primary outcome events, and the other is the effect of changing the hazard of intercurrent events. The first source is also quantified by the hypothetical strategy estimand Scenario I. The principal stratum strategy considers a subpopulation defined by potential intercurrent events, typically where such events would not occur under either treatment condition.</p>
<p>In general, the hypothetical strategy and principal stratum strategy target some direct effects, while other strategies target some total effects. Identifying direct effects requires stronger assumptions, such as sequential ignorability or principal ignorability. Under the multi-state model, let the original status, intercurrent event status, and primary outcome event status be three compartments. Then the potential CIF under the composite variable strategy is the probability of being in either state of intercurrent events or primary outcome events, whereas the potential CIF under the while on treatment strategy is the probability of being in the state of primary outcome events developed directly following the initial status. If the data are of the semi-competing risks structure, the potential CIF under the treatment policy strategy represents the probability of being in the state of primary outcome events, regardless of whether intercurrent events occur before the primary outcome events.</p>
</div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=tteICE" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/mephas/tteICE/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/mephas/tteICE/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing tteICE</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Yuhao Deng <br><small class="roles"> Author </small>   </li>
<li>Yi Zhou <br><small class="roles"> Maintainer </small>   </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=tteICE" class="external-link"><img src="https://www.r-pkg.org/badges/version/tteICE" alt="CRAN status"></a></li>
<li><a href="https://cran.r-project.org/package=tteICE" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/grand-total/tteICE" alt="CRAN downloads total"></a></li>
<li><a href="https://cran.r-project.org/package=tteICE" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/last-month/tteICE" alt="CRAN downloads last month"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Yuhao Deng, Yi Zhou.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
